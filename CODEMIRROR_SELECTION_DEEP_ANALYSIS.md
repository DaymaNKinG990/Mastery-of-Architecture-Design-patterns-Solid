# üî¨ –ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã –≤—ã–¥–µ–ª–µ–Ω–∏—è –≤ CodeMirror 5

## üìä –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Å–æ–ª—å–Ω—ã—Ö –ª–æ–≥–æ–≤

### –ò–∑ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –≤–∏–¥–Ω–æ:

1. **CodeMirror –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ** –¥–ª—è 4 —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π:
   - `code_input_srp_refactoring_01` ‚úÖ
   - `code_input_srp_order_processor` ‚úÖ
   - `code_input_srp_file_manager` ‚úÖ
   - `code_input_srp_ecommerce_system` ‚úÖ

2. **Selection test –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É:**
   ```
   hasSelection: false
   selectionText: ''
   selectionLength: 0
   ```
   **–î–ª—è –≤—Å–µ—Ö 4 —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π** - –≤—ã–¥–µ–ª–µ–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!

3. **Non-passive event listeners (12 –Ω–∞—Ä—É—à–µ–Ω–∏–π):**
   - `touchstart` (4x)
   - `touchmove` (4x)
   - `mousewheel` (4x)
   - –í—Å–µ –∏–∑ `codemirror.min.js:1`
   - –≠—Ç–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è, –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, –Ω–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Ç–æ, —á—Ç–æ CodeMirror –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è

4. **Forced reflow violations:**
   - 138ms, 53ms, 30ms
   - –ü—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –Ω–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ

## üéØ –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–æ–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π `mousemove` –∏ `mouseup` **–∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—Ç** —Å–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º –º–µ—Ö–∞–Ω–∏–∑–º–æ–º –≤—ã–¥–µ–ª–µ–Ω–∏—è CodeMirror 5.

CodeMirror 5 –∏–º–µ–µ—Ç **–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –≤—ã–¥–µ–ª–µ–Ω–∏—è**, –∫–æ—Ç–æ—Ä—ã–π:
1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –º—ã—à–∏
2. –£–ø—Ä–∞–≤–ª—è–µ—Ç –≤—ã–¥–µ–ª–µ–Ω–∏–µ–º —á–µ—Ä–µ–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π API
3. –ù–µ —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

**–ú–æ–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏:**
- –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—é—Ç —Å–æ–±—ã—Ç–∏—è –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ CodeMirror –∏—Ö –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç
- –ë–ª–æ–∫–∏—Ä—É—é—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ
- –°–æ–∑–¥–∞—é—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç –º–µ–∂–¥—É –º–æ–∏–º –∫–æ–¥–æ–º –∏ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º –º–µ—Ö–∞–Ω–∏–∑–º–æ–º

## ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### –ü—Ä–∏–Ω—Ü–∏–ø: –ù–ï –º–µ—à–∞—Ç—å CodeMirror —Ä–∞–±–æ—Ç–∞—Ç—å

CodeMirror 5 –¥–æ–ª–∂–µ–Ω —Å–∞–º –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏–µ. –ù–∞–º –Ω—É–∂–Ω–æ:
1. **–£–±—Ä–∞—Ç—å** –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ `mousemove` –∏ `mouseup`
2. **–û—Å—Ç–∞–≤–∏—Ç—å** —Ç–æ–ª—å–∫–æ –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É `mousedown` –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
3. **–í–∫–ª—é—á–∏—Ç—å** `dragDrop: true` (–º–æ–∂–µ—Ç –±—ã—Ç—å –Ω—É–∂–µ–Ω –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è)
4. **–£–±–µ–¥–∏—Ç—å—Å—è**, —á—Ç–æ CSS –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—ã–¥–µ–ª–µ–Ω–∏–µ

## üìù –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### –ë—ã–ª–æ (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û):
```javascript
// –ú–æ–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞–ª–∏ —Å CodeMirror
editor.on('mousedown', (cm, event) => {
    // ... –º–æ–π –∫–æ–¥ ...
    selectionStart = {line: coords.line, ch: coords.ch};
    isSelecting = true;
});

editor.on('mousemove', (cm, event) => {
    // –ú–û–ô –ö–û–î –ü–ï–†–ï–•–í–ê–¢–´–í–ê–õ –°–û–ë–´–¢–ò–Ø
    if (isSelecting && selectionStart) {
        doc.setSelection(selectionStart, coords);
    }
});

editor.on('mouseup', (cm, event) => {
    // –ú–û–ô –ö–û–î –ë–õ–û–ö–ò–†–û–í–ê–õ –í–°–¢–†–û–ï–ù–ù–û–ï –í–´–î–ï–õ–ï–ù–ò–ï
    doc.setSelection(selectionStart, coords);
});
```

### –°—Ç–∞–ª–æ (–ü–†–ê–í–ò–õ–¨–ù–û):
```javascript
// –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ - —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
editor.on('mousedown', (cm, event) => {
    // –¢–æ–ª—å–∫–æ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–µ—Ä–≤–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
    if (isFirstInteraction) {
        // ... —Å–±—Ä–æ—Å –≤—ã–¥–µ–ª–µ–Ω–∏—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∫–ª–∏–∫–µ ...
        isFirstInteraction = false;
    }
    
    // Focus - CodeMirror —Å–∞–º –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç –≤—ã–¥–µ–ª–µ–Ω–∏–µ
    if (!cm.hasFocus()) {
        cm.focus();
    }
});

// –£–ë–†–ê–ù–´ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ mousemove –∏ mouseup
// CodeMirror 5 —Å–∞–º –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—ã–¥–µ–ª–µ–Ω–∏–µ!
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏:
```javascript
dragDrop: true,  // –í–∫–ª—é—á–µ–Ω–æ - –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω—É–∂–Ω–æ –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è
inputStyle: 'textarea',  // –ò—Å–ø–æ–ª—å–∑—É–µ–º textarea (default)
```

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

–î–æ–±–∞–≤–ª–µ–Ω —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –æ—Ç–ª–∞–¥–æ—á–Ω—ã–π –∫–æ–¥:

```javascript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –≤—ã–¥–µ–ª–µ–Ω–∏—è
const testSelection = editor.getSelection();
const doc = editor.getDoc();
const wrapper = editor.getWrapperElement();

console.log(`üîç Selection test:`, {
    hasSelection: editor.somethingSelected(),
    selectionText: testSelection,
    cursorPos: doc.getCursor(),
    hasFocus: editor.hasFocus(),
    readOnly: editor.getOption('readOnly'),
    dragDrop: editor.getOption('dragDrop'),
    wrapperUserSelect: window.getComputedStyle(wrapper).userSelect
});

// –¢–µ—Å—Ç –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –≤—ã–¥–µ–ª–µ–Ω–∏—è
doc.setSelection({line: 0, ch: 0}, {line: 0, ch: 5});
const testHasSelection = editor.somethingSelected();
console.log(`üß™ Programmatic selection test:`, {
    success: testHasSelection,
    selectedText: editor.getSelection()
});
```

## üß™ –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

1. **–û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É** (Ctrl+F5)
2. **–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å** (F12)
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
   - –î–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è `üîç Selection test`
   - –î–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ `üß™ Programmatic selection test`
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `success: true` –≤ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–º —Ç–µ—Å—Ç–µ

4. **–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—ã–¥–µ–ª–∏—Ç—å —Ç–µ–∫—Å—Ç:**
   - –ó–∞–∂–º–∏—Ç–µ –õ–ö–ú
   - –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∫—É—Ä—Å–æ—Ä
   - –¢–µ–∫—Å—Ç –¥–æ–ª–∂–µ–Ω –≤—ã–¥–µ–ª–∏—Ç—å—Å—è

5. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª–∏ –ø–æ—Å–ª–µ –≤—ã–¥–µ–ª–µ–Ω–∏—è:**
   ```javascript
   // –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
   const editor = window.getCodeEditor('code_input_srp_refactoring_01');
   console.log('Has selection:', editor.somethingSelected());
   console.log('Selection:', editor.getSelection());
   ```

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ï—Å–ª–∏ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ:

1. **–ü—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π —Ç–µ—Å—Ç –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å:**
   ```
   üß™ Programmatic selection test: {
       success: true,
       selectedText: "...",
       length: 5
   }
   ```

2. **–ü–æ—Å–ª–µ –≤—ã–¥–µ–ª–µ–Ω–∏—è –º—ã—à–∫–æ–π:**
   ```javascript
   editor.somethingSelected()  // –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å true
   editor.getSelection()       // –¥–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
   ```

3. **–í–∏–∑—É–∞–ª—å–Ω–æ:**
   - –¢–µ–∫—Å—Ç –¥–æ–ª–∂–µ–Ω –≤—ã–¥–µ–ª—è—Ç—å—Å—è —Å–∏–Ω–∏–º/—Å–µ—Ä—ã–º —Ü–≤–µ—Ç–æ–º
   - –í—ã–¥–µ–ª–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤–∏–¥–Ω–æ

## üö® –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏—é CodeMirror:**
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è CodeMirror 5.65.16
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ CDN –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å CSS:**
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `.CodeMirror-selected` –≤–∏–¥–µ–Ω
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å z-index –∏ –¥—Ä—É–≥–∏–µ —Å—Ç–∏–ª–∏

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã:**
   - –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –¥—Ä—É–≥–∏–µ —Å–∫—Ä–∏–ø—Ç—ã
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ—Ç –ª–∏ –¥—Ä—É–≥–∏—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π

4. **–†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã:**
   - –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ CodeMirror 6 (–ª—É—á—à–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—ã–¥–µ–ª–µ–Ω–∏—è)
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–∞—Ç–∏–≤–Ω–æ–≥–æ textarea —Å —É–ª—É—á—à–µ–Ω–∏—è–º–∏

## üìù –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

```
‚úèÔ∏è docs/assets/js/code-editor.js
   ‚Ä¢ –£–±—Ä–∞–Ω—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ mousemove –∏ mouseup
   ‚Ä¢ –û—Å—Ç–∞–≤–ª–µ–Ω–∞ —Ç–æ–ª—å–∫–æ –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ mousedown
   ‚Ä¢ –í–∫–ª—é—á–µ–Ω dragDrop: true
   ‚Ä¢ –î–æ–±–∞–≤–ª–µ–Ω —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –æ—Ç–ª–∞–¥–æ—á–Ω—ã–π –∫–æ–¥
```

---

**–°—Ç–∞—Ç—É—Å:** üîç –ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à—ë–Ω, —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ  
**–í–µ—Ä—Å–∏—è:** 1.0.6  
**–î–∞—Ç–∞:** 2024-11-24

